# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.
image:
  file: .gitpod.Dockerfile

ports:
  - port: 5000
    onOpen: ignore

tasks:
  - name: install pre-commit git hooks
    init: pre-commit install
  - name: start up buildkitd
    command: |
      sudo /usr/bin/buildkitd --debug  --config ./buildkitd.toml --group gitpod
  - name: start a local docker registry
    command: |
      mkdir -p /workspace/registry
      docker run -p 5000:5000 --name registry --rm -v /workspace/registry:/var/lib/registry registry:2
    openMode: split-right
  - name: dazzle build and test
    command: |
      gp ports await 5000
      REPO=localhost:5000/dazzle
      echo "To build specific chunks and combine them 'time ./build-chunk.sh  -c chunk1 -c chunk2:variant1.2.3 -n combo'"
      echo "To build all the chunks and combinations 'time ./build-all.sh'"
      echo "To build a specific combination 'time ./build-combo.sh combo'"
      echo "To list image chunks 'dazzle project image-name $REPO'"
      echo "To list hashes for image chunks 'dazzle project hash $REPO'"
      echo "To print the combined image maniest 'dazzle project manifest $REPO'"
    openMode: tab-after
  - init: npm install
  - name: Web Browser
    openMode: split-right
    env:
      WEBSERVER_PORT: 8080
    command: |
      gp await-port $WEBSERVER_PORT
      lynx `gp url`


github:
  prebuilds:
    # enable for the master/default branch (defaults to true)
    master: true
    # enable for all branches in this repo (defaults to false)
    branches: true
    # enable for pull requests coming from this repo (defaults to true)
    pullRequests: true
    # enable for pull requests coming from forks (defaults to false)
    pullRequestsFromForks: true
    # add a "Review in Gitpod" button as a comment to pull requests (defaults to true)
    addComment: true
    # add a "Review in Gitpod" button to pull requests (defaults to false)
    addBadge: true
    # add a label once the prebuild is ready to pull requests (defaults to false)
    addLabel: prebuilt-in-gitpod
    
vscode:
  extensions:
    - ritwickdey.LiveServer
    - glenn2223.live-sass
    - kamikillerto.vscode-colorize
    - aaron-bond.better-comments
    
